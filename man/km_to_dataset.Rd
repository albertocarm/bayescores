% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/km_to_dataset.R
\name{km_to_dataset}
\alias{km_to_dataset}
\title{Digitize Kaplan-Meier Curves and Reconstruct IPD}
\usage{
km_to_dataset(
  img_path,
  time_breaks,
  n_risk_list,
  output_filename,
  num_curves = 2,
  x_start,
  x_end,
  x_increment,
  y_start,
  y_end,
  y_increment,
  y_text_vertical = TRUE,
  censoring = FALSE
)
}
\arguments{
\item{img_path}{Character string. The full path to the image file (e.g., PNG, JPG)
containing the KM curves.}

\item{time_breaks}{Numeric vector. A sequence of time points that define the
intervals for the number-at-risk table. For example, `seq(0, 60, 12)`.}

\item{n_risk_list}{A named list where each element is a numeric vector
representing the number of patients at risk for one arm. The names of the
list elements will be used as arm names (e.g., `list(control = c(...), treatment = c(...))`).
The order of arms must correspond to the order of curves digitized (curve 1, curve 2).}

\item{output_filename}{Character string or `NULL`. The name for the output
`.Rda` file that will contain the final combined IPD data frame. If `NULL` or
empty, the data is returned but not saved to a file. The file is saved in the same directory as `img_path`.}

\item{num_curves}{Integer. The number of KM curves to digitize from the image.
Default is 2.}

\item{x_start, x_end, x_increment}{Numeric values defining the x-axis (time) scale.}

\item{y_start, y_end, y_increment}{Numeric values defining the y-axis (survival probability) scale.}

\item{y_text_vertical}{Logical. Set to `TRUE` if the y-axis tick labels are
written vertically. Default is `TRUE`.}

\item{censoring}{Logical. Set to `TRUE` if censoring marks are present on the
curves and need to be digitized. Default is `FALSE`.}
}
\value{
A single data frame containing the combined IPD for all processed arms.
  The data frame includes columns for 'time', 'event', and 'arm'.
}
\description{
This function orchestrates the entire workflow for reconstructing Individual
Patient Data (IPD) from an image of Kaplan-Meier (KM) curves. It first
digitizes the curves from the image using `SurvdigitizeR::survival_digitize`,
then processes each curve individually to clean the data and generate IPD
using the Guyot et al. algorithm via `survHE::digitise`.
}
\examples{
\dontrun{
# This is a conceptual example as it requires an actual image file.
# 1. Define parameters
image_file <- "path/to/your/km_curve_image.png"
output_data_file <- "reconstructed_ipd.Rda"

# Time intervals from the x-axis of the publication's graph
time_points <- seq(0, 60, by = 12)

# Number at risk data from the publication's table
risk_data <- list(
  Control = c(500, 450, 400, 300, 200, 100),
  Treatment = c(502, 480, 460, 410, 350, 250)
)

# 2. Run the main function
final_ipd_dataset <- km_to_dataset(
  img_path = image_file,
  time_breaks = time_points,
  n_risk_list = risk_data,
  output_filename = output_data_file,
  num_curves = 2,
  x_start = 0, x_end = 60, x_increment = 12,
  y_start = 0, y_end = 1, y_increment = 0.2
)

# 3. Analyze the resulting dataset
if (exists("final_ipd_dataset")) {
  library(survival)
  library(survminer)

  fit <- survfit(Surv(time, event) ~ arm, data = final_ipd_dataset)
  print(summary(fit))

  ggsurvplot(
     fit,
     data = final_ipd_dataset,
     risk.table = TRUE,
     legend.title = "Group"
  )
}
}
}
